<!DOCTYPE html>
<html lang="en">
<head>
HEAD
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABA NAMUREMBO - Family Contributions Group</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f4e8;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        header {
            text-align: center;
            background-color: #ffcc00;
            padding: 20px;
            border-radius: 10px;
        }
        h1 {
            color: #006600;
        }
        p.motto {
            font-style: italic;
            color: #666;
        }
        section {
            margin: 20px 0;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #member-search {
            margin-bottom: 10px;
        }
        #member-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .member-card {
            background-color: #e6ffe6;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .remove-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            padding: 2px 5px;
        }
        .remove-btn:hover {
            background-color: #cc0000;
        }
        form {
            margin-top: 10px;
        }
        input[type="text"], input[type="date"], input[type="number"] {
            padding: 5px;
            margin-right: 5px;
        }
        button {
            padding: 5px 10px;
            background-color: #006600;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #009900;
        }
        .contribution-list {
            list-style-type: none;
            padding: 0;
        }
        .contribution-item {
            background-color: #f0f0f0;
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        #analysis {
            text-align: center;
        }
        #chart {
            max-width: 400px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <header>
        <h1>ABA NAMUREMBO</h1>
        <p class="motto">Together as a family, we build our future â€“ one contribution at a time.</p>
        <p>Welcome to our cherished family contributions group. Let's nurture our shared dreams with every Kenyan Shilling.</p>
    </header>

    <section id="members">
        <h2>Our Beloved Family Members</h2>
        <input type="text" id="member-search" placeholder="Search for a family member...">
        <div id="member-list"></div>
        <form id="add-member-form">
            <input type="text" id="new-member" placeholder="Enter new member's name" required>
            <button type="submit">Add New Family Member</button>
        </form>
    </section>

    <section id="contributions">
        <h2>Family Contributions</h2>
        <p>Select a member to view or add contributions in Kenyan Shillings (KES).</p>
        <div id="contribution-sections"></div>
    </section>

    <section id="analysis">
        <h2>Overall Family Progress</h2>
        <p>Total Family Savings: <span id="total-savings">0</span> KES</p>
        <p>Watch our collective growth! The chart below shows each member's total contributions.</p>
        <canvas id="contribution-chart"></canvas>
    </section>

    <script>
        // Data structure
        let familyData = {
            members: ['DAD', 'MOM', 'PIPI', 'NAWI', 'MAGA', 'REGI', 'LOLO', 'ZAC', 'LEONE', 'ANDY', 'PATRICE', 'JOHN', 'JOFU', 'NORA', 'PAUL', 'DUVU'],
            contributions: {}
        };

        // Initialize contributions for each member
        function initData() {
            familyData.members.forEach(member => {
                if (!familyData.contributions[member]) {
                    familyData.contributions[member] = [];
                }
            });
        }

        // Load data from localStorage
        function loadData() {
            const storedData = localStorage.getItem('abaNamuremboData');
            if (storedData) {
                familyData = JSON.parse(storedData);
            } else {
                initData();
                saveData();
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('abaNamuremboData', JSON.stringify(familyData));
        }

        // Render member list with search filter
        function renderMembers(searchTerm = '') {
            const memberList = document.getElementById('member-list');
            memberList.innerHTML = '';
            const filteredMembers = familyData.members.filter(member => 
                member.toLowerCase().includes(searchTerm.toLowerCase())
            );
            filteredMembers.forEach(member => {
                const card = document.createElement('div');
                card.className = 'member-card';
                card.innerHTML = `
                    ${member}
                    <button class="remove-btn" data-member="${member}">Remove</button>
                `;
                card.querySelector('.remove-btn').addEventListener('click', () => {
                    if (confirm(`Are you sure you want to remove ${member}?`)) {
                        familyData.members = familyData.members.filter(m => m !== member);
                        delete familyData.contributions[member];
                        saveData();
                        renderMembers(searchTerm);
                        renderContributions();
                        renderAnalysis();
                    }
                });
                memberList.appendChild(card);
            });
        }

        // Render contribution sections
        function renderContributions() {
            const sections = document.getElementById('contribution-sections');
            sections.innerHTML = '';
            const select = document.createElement('select');
            select.id = 'member-select';
            select.innerHTML = '<option value="">Select a member</option>';
            familyData.members.forEach(member => {
                select.innerHTML += `<option value="${member}">${member}</option>`;
            });
            sections.appendChild(select);

            const contribDiv = document.createElement('div');
            contribDiv.id = 'selected-member-contrib';
            sections.appendChild(contribDiv);

            select.addEventListener('change', () => {
                const member = select.value;
                contribDiv.innerHTML = '';
                if (member) {
                    const div = document.createElement('div');
                    div.innerHTML = `<h3>${member}'s Contributions</h3>`;
                    
                    // Form to add contribution
                    const form = document.createElement('form');
                    form.innerHTML = `
                        <input type="date" class="contrib-date" required>
                        <input type="number" class="contrib-amount" placeholder="Amount in KES" min="0" required>
                        <button type="submit">Add Contribution</button>
                    `;
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const date = form.querySelector('.contrib-date').value;
                        const amount = parseFloat(form.querySelector('.contrib-amount').value);
                        if (date && amount) {
                            familyData.contributions[member].push({ date, amount });
                            saveData();
                            renderContributions();
                            renderAnalysis();
                        }
                    });
                    div.appendChild(form);

                    // List of contributions
                    const ul = document.createElement('ul');
                    ul.className = 'contribution-list';
                    familyData.contributions[member].forEach(contrib => {
                        const li = document.createElement('li');
                        li.className = 'contribution-item';
                        li.textContent = `${contrib.date}: ${contrib.amount.toLocaleString()} KES`;
                        ul.appendChild(li);
                    });
                    div.appendChild(ul);
                    contribDiv.appendChild(div);
                }
            });
        }

        // Render analysis
        function renderAnalysis() {
            // Calculate total
            let total = 0;
            const memberTotals = {};
            familyData.members.forEach(member => {
                memberTotals[member] = familyData.contributions[member].reduce((sum, contrib) => sum + contrib.amount, 0);
                total += memberTotals[member];
            });
            document.getElementById('total-savings').textContent = total.toLocaleString();

            // Chart
            const ctx = document.getElementById('contribution-chart').getContext('2d');
            if (window.myChart) {
                window.myChart.destroy();
            }
            window.myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: familyData.members,
                    datasets: [{
                        data: familyData.members.map(m => memberTotals[m]),
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                            '#FF9F40', '#E7E9ED', '#C9CBCF', '#ADFF2F', '#FFD700',
                            '#20B2AA', '#87CEEB', '#778899', '#B0C4DE', '#FFE4C4', '#FF4500'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.label}: ${context.raw.toLocaleString()} KES`
                            }
                        }
                    }
                }
            });
        }

        // Add new member
        document.getElementById('add-member-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const newMember = document.getElementById('new-member').value.trim().toUpperCase();
            if (newMember && !familyData.members.includes(newMember)) {
                familyData.members.push(newMember);
                familyData.contributions[newMember] = [];
                saveData();
                renderMembers(document.getElementById('member-search').value);
                renderContributions();
                renderAnalysis();
                document.getElementById('new-member').value = '';
            }
        });

        // Search functionality
        document.getElementById('member-search').addEventListener('input', (e) => {
            renderMembers(e.target.value);
        });

        // Initial load
        loadData();
        renderMembers();
        renderContributions();
        renderAnalysis();
    </script>
    
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸ’° Family Contributions</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    .card { background: #fff; padding: 20px; margin: 20px auto; width: 400px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    input, button { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #00b140; color: white; border: none; cursor: pointer; }
    button:hover { background: #008c34; }
    #results { margin-top: 20px; }
    .contribution { background: #f1f1f1; padding: 10px; border-radius: 5px; margin: 5px 0; }
    .export-buttons { margin-top: 15px; display: flex; gap: 10px; }
  </style>
</head>
<body>
  <h1>ðŸ’° Family Contributions</h1>

  <div class="card">
    <h3>Add Contribution</h3>
    <input type="text" id="nameInput" placeholder="Enter name">
    <input type="number" id="amountInput" placeholder="Enter amount">
    <button onclick="addContribution()">Submit</button>
  </div>

  <div class="card">
    <h3>Search Contributions</h3>
    <input type="text" id="searchInput" placeholder="Search by name..." onkeyup="searchContributions()">
    <div id="results"></div>
  </div>

  <div class="card">
    <h3>ðŸ“Š Family Summary</h3>
    <button onclick="generateSummary()">Generate Summary</button>
    <div class="export-buttons">
      <button onclick="exportPDF()">Export PDF</button>
      <button onclick="exportExcel()">Export Excel</button>
    </div>
    <div id="summary"></div>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDN7zu2pc-DRSTzEZLYq4BCXDKItiwbDi8",
      authDomain: "family-contributions.firebaseapp.com",
      projectId: "family-contributions",
      storageBucket: "family-contributions.firebasestorage.app",
      messagingSenderId: "322744991780",
      appId: "1:322744991780:web:eb4843cf64ef3245a218b1"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const contributionsRef = collection(db, "contributions");

    // Add contribution
    async function addContribution() {
      const name = document.getElementById("nameInput").value.trim();
      const amount = parseFloat(document.getElementById("amountInput").value);

      if (!name || isNaN(amount)) {
        alert("Please enter a valid name and amount.");
        return;
      }

      await addDoc(contributionsRef, { name, amount, date: new Date() });

      document.getElementById("nameInput").value = "";
      document.getElementById("amountInput").value = "";
      alert("Contribution added!");
    }

    // Search contributions by name
    async function searchContributions() {
      const searchValue = document.getElementById("searchInput").value.trim().toLowerCase();
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (!searchValue) return;

      const q = query(contributionsRef, where("name", "==", searchValue));
      const querySnapshot = await getDocs(q);

      let total = 0;
      querySnapshot.forEach(doc => {
        const data = doc.data();
        resultsDiv.innerHTML += `<div class="contribution">${data.name} - $${data.amount}</div>`;
        total += data.amount;
      });

      if (total > 0) {
        resultsDiv.innerHTML += `<div><b>Total: $${total}</b></div>`;
      } else {
        resultsDiv.innerHTML = "<p>No contributions found.</p>";
      }
    }

    // Generate family summary (live updates)
    function generateSummary() {
      const summaryDiv = document.getElementById("summary");
      summaryDiv.innerHTML = "<p>Loading...</p>";

      onSnapshot(contributionsRef, (snapshot) => {
        const contributions = {};
        snapshot.forEach(doc => {
          const data = doc.data();
          if (!contributions[data.name]) contributions[data.name] = 0;
          contributions[data.name] += data.amount;
        });

        summaryDiv.innerHTML = "<h4>Family Contributions</h4>";
        let grandTotal = 0;
        for (const [name, total] of Object.entries(contributions)) {
          summaryDiv.innerHTML += `<div>${name}: $${total}</div>`;
          grandTotal += total;
        }
        summaryDiv.innerHTML += `<hr><b>Grand Total: $${grandTotal}</b>`;
      });
    }

    // Export to PDF
    async function exportPDF() {
      const { jsPDF } = await import("https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.es.min.js");
      const doc = new jsPDF();
      doc.text("Family Contributions Summary", 10, 10);

      let y = 20;
      const snapshot = await getDocs(contributionsRef);
      let contributions = {};
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        if (!contributions[data.name]) contributions[data.name] = 0;
        contributions[data.name] += data.amount;
      });

      let grandTotal = 0;
      for (const [name, total] of Object.entries(contributions)) {
        doc.text(`${name}: $${total}`, 10, y);
        y += 10;
        grandTotal += total;
      }
      doc.text(`Grand Total: $${grandTotal}`, 10, y + 10);

      doc.save("family_contributions.pdf");
    }

    // Export to Excel
    async function exportExcel() {
      const XLSX = await import("https://cdn.jsdelivr.net/npm/xlsx@0.18.5/+esm");
      const snapshot = await getDocs(contributionsRef);

      let contributions = {};
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        if (!contributions[data.name]) contributions[data.name] = 0;
        contributions[data.name] += data.amount;
      });

      let rows = [["Name", "Total"]];
      for (const [name, total] of Object.entries(contributions)) {
        rows.push([name, total]);
      }

      const worksheet = XLSX.utils.aoa_to_sheet(rows);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, "Contributions");
      XLSX.writeFile(workbook, "family_contributions.xlsx");
    }

    // Make functions global
    window.addContribution = addContribution;
    window.searchContributions = searchContributions;
    window.generateSummary = generateSummary;
    window.exportPDF = exportPDF;
    window.exportExcel = exportExcel;

  </script>
d313ee2 (Add Firebase-authenticated Family Contributions app)
</body>
</html>
